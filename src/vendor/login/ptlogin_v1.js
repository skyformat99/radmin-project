var pt=function(){var params={};var callbacks={};var uiUrl="";var appendTo=null;var ptuiWidth=625;var ptuiHeight=400;var lastUrl="";var loginHost="";var mask=null;var e={_counter:0,_uid:function(){return"h"+e._counter++},add:function(element,eventType,handler){if(document.addEventListener){element.addEventListener(eventType,handler,false)}else{if(document.attachEvent){if(e._find(element,eventType,handler)!=-1){return}var wrappedHandler=function(e){if(!e){e=window.event}var event={_event:e,type:e.type,target:e.srcElement,currentTarget:element,relatedTarget:e.fromElement?e.fromElement:e.toElement,eventPhase:(e.srcElement==element)?2:3,clientX:e.clientX,clientY:e.clientY,screenX:e.screenX,screenY:e.screenY,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,keyCode:e.keyCode,origin:e.origin,data:e.data,stopPropagation:function(){this._event.cancelBubble=true},preventDefault:function(){this._event.returnValue=false}};if(Function.prototype.call){handler.call(element,event)}else{element._currentHandler=handler;element._currentHandler(event);element._currentHandler=null}};element.attachEvent("on"+eventType,wrappedHandler);var h={element:element,eventType:eventType,handler:handler,wrappedHandler:wrappedHandler};var d=element.document||element;var w=d.parentWindow;var id=e._uid();if(!w._allHandlers){w._allHandlers={}}w._allHandlers[id]=h;if(!element._handlers){element._handlers=[]}element._handlers.push(id);if(!w._onunloadHandlerRegistered){w._onunloadHandlerRegistered=true;w.attachEvent("onunload",e._removeAllHandlers)}}}},remove:function(element,eventType,handler){if(document.addEventListener){element.removeEventListener(eventType,handler,false)}else{if(document.attachEvent){var i=e._find(element,eventType,handler);if(i==-1){return}var d=element.document||element;var w=d.parentWindow;var handlerId=element._handlers[i];var h=w._allHandlers[handlerId];element.detachEvent("on"+eventType,h.wrappedHandler);element._handlers.splice(i,1);delete w._allHandlers[handlerId]}}},_find:function(element,eventType,handler){var handlers=element._handlers;if(!handlers){return -1}var d=element.document||element;var w=d.parentWindow;for(var i=handlers.length-1;i>=0;i--){var handlerId=handlers[i];var h=w._allHandlers[handlerId];if(h.eventType==eventType&&h.handler==handler){return i}}return -1},_removeAllHandlers:function(){var w=this;for(id in w._allHandlers){var h=w._allHandlers[id];h.element.detachEvent("on"+h.eventType,h.wrappedHandler);delete w._allHandlers[id]}},src:function(e){return e?e.target:event.srcElement},stopPropagation:function(e){e?e.stopPropagation():event.cancelBubble=true}};var getCookie=function(n){var m=document.cookie.match(new RegExp("(^| )"+n+"=([^;]*)(;|$)"));return !m?"":decodeURIComponent(m[2])};var delCookie=function(name,domain,path){document.cookie=name+"=; expires=Mon, 26 Jul 1997 05:00:00 GMT; path="+(path?path:"/")+"; "+(domain?("domain="+domain+";"):"")};var preload=function(url){var img=new Image();img.src=url;img=null};var monitor=function(id,probability){if(Math.random()>(probability||1)){return}var url=location.protocol+"//ui.ptlogin2.qq.com/cgi-bin/report?id="+id+"&v="+Math.random();preload(url)};var setParam=function(key,value){params[key]=value};var setParams=function(param){params=param};var setCallback=function(key,value){callbacks[key]=value};var getUiUrl=function(){var prefix=params.protocol||"http:";prefix+="//";var domain=params.domain||"qq.com";if(params.protocol=="https:"&&domain!="qq.com"&&domain!="tenpay.com"){prefix="https://ssl."}uiUrl=prefix+"xui.ptlogin2."+domain;loginHost=uiUrl;var url=uiUrl+"/cgi-bin/xlogin?";var urlParam="";for(var key in params){if(key=="protocol"||key=="domain"){continue}else{urlParam+=(key+"="+encodeURIComponent(params[key])+"&")}}url+=urlParam;return url};var createPtui=function(url,append){if(!append){appendTo=document.createElement("div");document.body.appendChild(appendTo);var cssText="left:50%;";cssText+="top:50%;";cssText+="position:fixed;";cssText+="z-index:9999;";cssText+="background:none;";cssText+="_position:absolute;";cssText+="_top:expression(eval(document.documentElement.scrollTop+(document.documentElement.clientHeight-this.offsetHeight)/2));";cssText+="_margin-top:0px;";appendTo.style.cssText=cssText}else{appendTo=append}appendTo.innerHTML='<iframe name="ui_ptlogin" id="ui_ptlogin" allowtransparency="true" scrolling="no" frameborder="0" width="100%" height="100%" style="top:0; left:0; position: absolute;'+(params.border_radius==1?"border-radius:5px;":"")+'" src="'+url+'">'};var showPtui=function(append){var url=getUiUrl();if(lastUrl){if(url==lastUrl){}else{document.getElementById("ui_ptlogin").src=url}}else{createPtui(url,append);if(!-[1,]&&!window.XMLHttpRequest){ptlogin2_onResize(ptuiWidth-1,ptuiHeight-1)}}lastUrl=url;showMask();appendTo.style.display="block"};var hidePtui=function(){appendTo.style.display="none";hideMask()};var showMask=function(){var maskOpacity=params.maskOpacity||40;if(maskOpacity==0){return}if(!mask){var cssText="background-color:#000;overflow:hidden;position:fixed;left:0;top:0;width:100%;height:100%;z-index:9998;opacity:"+maskOpacity/100+";filter:alpha(opacity="+maskOpacity+");";cssText+="_position:absolute;_height:expression(eval(document.documentElement.scrollTop+document.documentElement.clientHeight));_width:expression(eval(document.documentElement.scrollLeft+document.documentElement.clientWidth));";mask=document.createElement("div");mask.style.cssText=cssText;document.body.appendChild(mask)}mask.style.display="block"};var hideMask=function(){mask&&(mask.style.display="none")};var ptlogin2_onResize=function(width,height){var login_wnd=appendTo;if(login_wnd&&width>1&&height>1&&(ptuiWidth!=width||ptuiHeight!=height)){if(typeof callbacks.resize=="function"){callbacks.resize(parseInt(width),parseInt(height))}else{login_wnd.style.width=width+"px";login_wnd.style.height=height+"px";login_wnd.style.marginLeft=-width/2+"px";login_wnd.style.marginTop=-height/2+"px"}}ptuiWidth=width;ptuiHeight=height};var ptlogin2_onClose=function(){hidePtui()};var str2JSON=function(str){var data;if(typeof JSON!=="undefined"){data=JSON.parse(str)}else{eval("data="+str)}return data};var bindEvent=function(){if(typeof window.postMessage!="undefined"){e.add(window,"message",function(event){var origin=event.origin;if(origin!=loginHost){alert(origin);return}var data=str2JSON(event.data);switch(data.action){case"close":ptlogin2_onClose();break;case"resize":ptlogin2_onResize(data.width,data.height);break;default:break}})}else{navigator.ptlogin_callback=function(msg){var data=str2JSON(msg);switch(data.action){case"close":ptlogin2_onClose();break;case"resize":ptlogin2_onResize(data.width,data.height);break;default:break}}}};var init=function(){bindEvent();window.setTimeout(function(){monitor(447926,1)},1000)};var appDomain="";var mainDomain="";var initDomain=function(){mainDomain=location.hostname.match(/\w*\.(com|cn)$/);mainDomain=mainDomain?mainDomain[0]:"";appDomain=location.hostname.match(/\w+(\.\w+){2}$/);appDomain=appDomain?appDomain[0]:"";if(mainDomain!="qq.com"){appDomain=mainDomain}};var getLogoutUrl=function(){var pt4_token=getCookie("pt4_token");var skey=getCookie("skey");var pt4_hkey=hash33(skey);var ptcz=getCookie("ptcz");var pt4_ptcz=hash33(ptcz);var logoutUrl="";logoutUrl=((location.protocol=="https:")?"https://ssl.":"http://")+"ptlogin2."+mainDomain+"/logout?";logoutUrl+=("pt4_token="+pt4_token+"&pt4_hkey="+pt4_hkey+"&pt4_ptcz="+pt4_ptcz+"&deep_logout=1");return logoutUrl};var hash33=function(str){var hash=0;for(var i=0,length=str.length;i<length;++i){hash+=(hash<<5)+str.charCodeAt(i)}return hash&2147483647};var clearCookie=function(){delCookie("uin",mainDomain);delCookie("skey",mainDomain);delCookie("p_uin",appDomain);delCookie("p_skey",appDomain);delCookie("p_luin",appDomain);delCookie("p_lskey",appDomain);delCookie("pt4_token",appDomain);delCookie("pt_mbkey",mainDomain);if(appDomain!=""&&getCookie("skey_m")!=""){delCookie("uin_m",appDomain);delCookie("skey_m",appDomain)}};var logout=function(callback){initDomain();var pt4_token=getCookie("pt4_token");var skey=getCookie("skey");var ptcz=getCookie("ptcz");var url=getLogoutUrl();if(!pt4_token&&!skey&&!ptcz){}else{preload(url)}window.setTimeout(function(){callback&&callback(2)},100)};init();return{showPtui:showPtui,hidePtui:hidePtui,setParam:setParam,setParams:setParams,setCallback:setCallback,logout:logout}}();